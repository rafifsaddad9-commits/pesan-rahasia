<!DOCTYPE html>
<html>
<head>
    <title>3D Retro Racer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: white; font-size: 24px; font-weight: bold; pointer-events: none; }
        canvas { display: block; }
        .controls { position: absolute; bottom: 0; width: 100%; height: 70%; display: flex; }
        .btn { flex: 1; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body>
    <div id="ui">SCORE: 0</div>
    <div class="controls">
        <div class="btn" id="left"></div>
        <div class="btn" id="right"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
    let scene, camera, renderer, player, enemies = [], score = 0, gameActive = true;
    let speed = 0.5;

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x111111);
        scene.fog = new THREE.Fog(0x111111, 10, 50);

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 5);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lampu
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(0, 5, 5).normalize();
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // Jalanan
        const roadGeo = new THREE.PlaneGeometry(10, 1000);
        const roadMat = new THREE.MeshPhongMaterial({ color: 0x222222 });
        const road = new THREE.Mesh(roadGeo, roadMat);
        road.rotation.x = -Math.PI / 2;
        scene.add(road);

        // Garis Jalan
        for(let i=0; i<100; i++) {
            const lineGeo = new THREE.PlaneGeometry(0.2, 2);
            const lineMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
            const line = new THREE.Mesh(lineGeo, lineMat);
            line.rotation.x = -Math.PI / 2;
            line.position.set(0, 0.01, -i * 10);
            scene.add(line);
        }

        // Mobil Player (Badannya 3D)
        const bodyGeo = new THREE.BoxGeometry(1, 0.5, 2);
        const bodyMat = new THREE.MeshPhongMaterial({ color: 0xff0000 });
        player = new THREE.Mesh(bodyGeo, bodyMat);
        player.position.y = 0.25;
        scene.add(player);

        spawnEnemy();
        animate();
    }

    function spawnEnemy() {
        const colors = [0xffff00, 0x00ff00, 0x0000ff];
        const geo = new THREE.BoxGeometry(1, 0.5, 2);
        const mat = new THREE.MeshPhongMaterial({ color: colors[Math.floor(Math.random()*colors.length)] });
        const enemy = new THREE.Mesh(geo, mat);
        enemy.position.set((Math.random() - 0.5) * 6, 0.25, -50);
        enemies.push(enemy);
        scene.add(enemy);
        
        if(gameActive) setTimeout(spawnEnemy, 1000 - (score * 2));
    }

    function animate() {
        if (!gameActive) return;
        requestAnimationFrame(animate);

        // Mobil bergerak maju (efek jalan)
        enemies.forEach((enemy, index) => {
            enemy.position.z += speed;
            
            // Cek Tabrakan
            if (Math.abs(player.position.x - enemy.position.x) < 0.8 && 
                Math.abs(player.position.z - enemy.position.z) < 1.5) {
                gameActive = false;
                alert("CRASHED! ðŸ’¥\nSkor: " + Math.floor(score));
                location.reload();
            }

            if (enemy.position.z > 10) {
                scene.remove(enemy);
                enemies.splice(index, 1);
                score += 10;
                document.getElementById('ui').innerText = "SCORE: " + score;
            }
        });

        speed += 0.0001; // Makin lama makin cepat
        renderer.render(scene, camera);
    }

    // Kontrol HP
    document.getElementById('left').ontouchstart = () => { if(player.position.x > -3) player.position.x -= 1; };
    document.getElementById('right').ontouchstart = () => { if(player.position.x < 3) player.position.x += 1; };

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init();
</script>
</body>
</html>
